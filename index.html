<html>
<head>
  <meta name="mphtools-feature" content="compatibilityUI, cameraPrivacyPopup, compatibilityAutoCheck">
</head>
<body>
  <button style="display: block;  width: 100%; height: 100%;  border: none;  background-color: #04AA6D;  color: white;  padding: 14px 28px;  font-size: 16px;  cursor: pointer;  text-align: center;" type="button" id="BeginButton" onclick="initRecog(this)">CLICK TO Access Video</button>	
  <style>.embed-container { position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; max-width: 100%; } .embed-container iframe, .embed-container object, .embed-container embed { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }</style><div class='embed-container'><iframe id= 'vid' src='https://www.youtube.com/embed//gSMK7b7DLrE' frameborder='0' allowfullscreen></iframe></div>
  <script src="https://thunkable.github.io/webviewer-extension/thunkableWebviewerExtension.js" type="text/javascript"></script>
  <script src="https://sdk.morphcast.com/mphtools/v1.0/mphtools.js"></script>
	<script src="https://ai-sdk.morphcast.com/v1.16/ai-sdk.js"></script>
	<script>
	
	let counters = [0, 0, 0, 0, 0];
	let counterNames = ["Happy", "Sad", "Angry", "Disgust", "Fear"];
	let checker = false;
	let link = "";
	
	
	
	function initRecog(button){
		//vidShuffle(link);
	if(checker == true){
		//document.getElementById("BeginButton").textContent = "CLICK ME TO BEGIN";
		let max = Math.max(...counters);
		let maxIndex = counters.indexOf(max);
		//console.log(counterNames[maxIndex] + ": " + max);
		//document.getElementById('vid').src = link;
		ThunkableWebviewerExtension.postMessage(maxIndex);
		checker = false;
		return;
	}
		//document.getElementById('vid').src = link;
		
		CY.loader()
	   .licenseKey("ed6a12c60375cfd79dca1cb5dcc58fd0f684c0b62c2c")
	   .addModule(CY.modules().FACE_AGE.name)
	   .addModule(CY.modules().FACE_GENDER.name)
	   .addModule(CY.modules().FACE_EMOTION.name)
	   .load()
	   .then(({ start, stop }) => start());
	   
	window.addEventListener(CY.modules().FACE_EMOTION.eventName, (evt) => {
		if(evt.detail.output.dominantEmotion == "Happy"){
			counters[0] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Sad"){
			counters[1] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Angry"){
			counters[2] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Disgust"){
			counters[3] += 1;
		}
		if(evt.detail.output.dominantEmotion == "Fear"){
			counters[4] += 1;
		}
	});
		checker = true;
		button.style.visibility = "hidden";
	}
		
	// when we get a message from the app, display it on the page
	ThunkableWebviewerExtension.receiveMessage(function(message) {
		link = message;
		//vidShuffle(link);
	 if(checker == true){
		//document.getElementById("BeginButton").textContent = "CLICK ME TO BEGIN";
		let max = Math.max(...counters);
		let maxIndex = counters.indexOf(max);
		//console.log(counterNames[maxIndex] + ": " + max);
		//document.getElementById('vid').src = message;
		ThunkableWebviewerExtension.postMessage(maxIndex);
		 checker = false;
		return;
	}
		document.getElementById('vid').src = message;
	});
	</script>
</body>
</html>
